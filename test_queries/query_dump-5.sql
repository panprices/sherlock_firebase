
		WITH offers_data AS (
			
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'e9baaccf-d8c1-4d08-ad51-ba048e2506c8' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung G985 S20+ Galaxy 4G 8GB RAM 128GB DS cloud blue' AS retail_prod_name,
				'MyMobil' AS retailer_name,
				'SE' AS country,
				812200 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/76745_KNA-TEL-704669?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'71cf686c-1138-4dc9-aa16-dd4592761aa6' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy S20+ - Pekskärmsmobil - dual-SIM - 4G LTE - 128 GB - microSD slot - GSM - 6.7 - 3200 x 1440 pixlar (525 ppi) - Infinity-O Dynamic AMOLED 2X - RAM 8 GB 10 megapixlar - 4x bakre kameror - Android - cosmic black' AS retail_prod_name,
				'ComputerSalg.se' AS retailer_name,
				'SE' AS country,
				815900 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/95107_6428223?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'22e9a095-541b-4740-b4ce-b974a072edc0' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'MOBILE PHONE GALAXY S20+ 128GB/BLUE SM-G985FLBDEUE SAMSUNG' AS retail_prod_name,
				'MyMobil' AS retailer_name,
				'SE' AS country,
				820300 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/76745_KNA-ELK-1298068?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'17b5e71a-f030-4d32-9b70-4b964fba8cff' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy S20+ Duos' AS retail_prod_name,
				'MyTrendyPhone' AS retailer_name,
				'SE' AS country,
				822900 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/21055_217529-VAR?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'b6f69432-6db1-4c2a-b28e-c946af793a8b' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy SM-G985F/DS, 17 cm (6.7), 8 GB, 128 GB, 12 MP, Android 10.0, Svart' AS retail_prod_name,
				'ComputerSalg.se' AS retailer_name,
				'SE' AS country,
				828100 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/95107_6630507?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'cfaa0b59-aaf6-45d2-a5ef-a961206a5ae1' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy S20+ Cosmic Black, 6.7 ", Dynamic AMOLED, 1440 x 3200' AS retail_prod_name,
				'MyMobil' AS retailer_name,
				'SE' AS country,
				828500 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/76745_KNA-ACC-307571?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'03db41b7-88e1-49aa-b65c-69e8423b52af' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy S20+ - Pekskärmsmobil - dual-SIM - 4G LTE - 128 GB - microSD slot - GSM - 6.7" - 3200 x 1440 pixlar (525 ppi) - Infinity-O Dynamic AMO' AS retail_prod_name,
				'Cdon' AS retailer_name,
				'SE' AS country,
				829200 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/1829_54020646?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'6db9151e-122a-4cc7-bb21-f8be6d62121e' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy S20+, 17 cm (6.7), 8 GB, 128 GB, 12 MP, Android 10.0, Blå' AS retail_prod_name,
				'ComputerSalg.se' AS retailer_name,
				'SE' AS country,
				832200 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/95107_6428222?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'6ea7f659-9b63-46e2-9a0d-ef2992e8d9e8' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy S20 Plus 128 GB, 6.7" QHD+, 64/12/12/10 Mpixel kamera, IP68, Dual SIM, MicroSD, Android - Grå' AS retail_prod_name,
				'Databyrån' AS retailer_name,
				'SE' AS country,
				839000 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/2265_59109?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'59bdbd96-2c57-4b89-a9b2-3bd6e716ad9b' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung G985 S20+ Galaxy 4G 8GB RAM 128GB DS cosmic black' AS retail_prod_name,
				'MyMobil' AS retailer_name,
				'SE' AS country,
				842000 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/76745_KNA-8806090307379?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'03d298b0-db82-4cd1-9a1e-6e8b68c1538b' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy SM-G985F/DS, 17 cm (6.7), 8 GB, 128 GB, 12 MP, Android 10.0, Svart' AS retail_prod_name,
				'ComputerSalg.se' AS retailer_name,
				'SE' AS country,
				842600 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/95107_6139310?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'098bbfe2-f625-49a9-83b2-d3672a2972d3' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy S20+, 17 cm (6.7"), 8 GB, 128 GB, 12 MP, Android 10.0, Blå' AS retail_prod_name,
				'Cdon' AS retailer_name,
				'SE' AS country,
				861700 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/1829_52047968?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'67b46c4d-939f-4ecb-874f-2fabf4d6e2a8' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy S20+, 17 cm (6.7"), 8 GB, 128 GB, 12 MP, Android 10.0, Blå' AS retail_prod_name,
				'Cdon' AS retailer_name,
				'SE' AS country,
				862308 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/1829_54022384?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'111067f4-171d-4ccd-a95c-90a927e55893' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy S20 Plus 4G 128GB - Cloud Blue' AS retail_prod_name,
				'Proshop' AS retailer_name,
				'SE' AS country,
				879000 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/40076_2832288?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'b9906e63-1fb4-4c77-8f9d-8f930e8e99d3' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'SAMSUNG S20Plus ds black' AS retail_prod_name,
				'Datia' AS retailer_name,
				'SE' AS country,
				911750 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/53120_SM-G985FZKDEUB?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'b73a1225-7b82-4591-b1a2-4dfd78d8b390' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Phone G985F Galaxy S20 Plus 128GB (Red)' AS retail_prod_name,
				'ComputerSalg.se' AS retailer_name,
				'SE' AS country,
				923200 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/95107_6657386?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'ace6c729-2629-4fd3-b129-913be45c3699' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy S20+ 17 cm (6.7) 8 GB 128 GB Dual SIM 4G USB Type-C Grå Android 10.0 4500 mAh' AS retail_prod_name,
				'ComputerSalg.se' AS retailer_name,
				'SE' AS country,
				983100 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/95107_6392337?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'e5b92835-47ec-4e15-88d3-d21b42753b3f' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy S20 Plus 128 GB, 6.7" QHD+, 64/12/12/10 Mpixel kamera, IP68, Dual SIM, MicroSD, Android - Svart' AS retail_prod_name,
				'Logic' AS retailer_name,
				'SE' AS country,
				999900 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/60608_8800?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'8fd8203b-0890-408c-85ca-da730ea702fb' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy SM-G985F/DS, 17 cm (6.7"), 8 GB, 128 GB, 12 MP, Android 10.0, Svart' AS retail_prod_name,
				'Cdon' AS retailer_name,
				'SE' AS country,
				1020510 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/1829_52862350?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'6da0bbf3-1073-4ef8-8bf9-ba070c5c2314' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'SAMSUNG S20Plus ds black' AS retail_prod_name,
				'WeKuData' AS retailer_name,
				'SE' AS country,
				1027875 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/39428_SAMSUNG-S20Plus-ds-black?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'7c073725-da4e-445f-a290-f3562d84748b' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy S20 Plus 128 GB Dual SIM Red' AS retail_prod_name,
				'ComputerSalg.se' AS retailer_name,
				'SE' AS country,
				1043600 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/95107_6662389?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'520dc9bd-d3f5-49d3-b774-da8d826bd005' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Smartphone Samsung Galaxy S20+ SM-G985FZKDEUB 6,7" Octa Core 8 GB RAM 128 GB Svart' AS retail_prod_name,
				'Gameexpo' AS retailer_name,
				'SE' AS country,
				1055900 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/111533_smartphone-samsung-galaxy-s20-sm-g985fzkdeub-6-7-octa-core-8-gb-ram-128-gb-svart?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'a7b96de7-abe7-4f02-a4c0-a735e432703b' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung F-SMG985FZKAMZ Galaxy S20+ Smartphone (16,95 cm) 128 GB Innerminne, 8 GB RAM, Hybrid SIM, Tysk Version, Svart' AS retail_prod_name,
				'Amazon.se' AS retailer_name,
				'SE' AS country,
				1070469 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/112488_B084DQ6FS6?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'85423823-6be4-4154-9acb-f8568364f3d1' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'Samsung Galaxy S20 + 128 GB Svart' AS retail_prod_name,
				'Cdon' AS retailer_name,
				'SE' AS country,
				1085000 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/1829_53681922?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'd3db12ec-0865-4a2c-bab2-cc6cd4f57f25' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_SE' AS offer_source,
				'SAMSUNG S20Plus ds black' AS retail_prod_name,
				'Compliq' AS retailer_name,
				'SE' AS country,
				1086875 AS price,
				'SEK' AS currency,
				'https://www.pricerunner.se/gotostore/v1/SE/26811_p1000689455?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'83d86148-dd57-49fc-893d-32e526d49b4e' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_UK' AS offer_source,
				'Samsung Galaxy S20+ Plus G985F-DS 8GB/128GB 4G Dual Sim - Grey' AS retail_prod_name,
				'TechintheBasket' AS retailer_name,
				'UK' AS country,
				55400 AS price,
				'GBP' AS currency,
				'https://www.pricerunner.com/gotostore/v1/UK/68095_17451613384?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'0c166623-d5e2-47a2-bfe4-f73d19a0b488' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_UK' AS offer_source,
				'Samsung G985 S20+ Galaxy 4G 8GB RAM 128GB DS cloud blue EU' AS retail_prod_name,
				'Amazon.co.uk' AS retailer_name,
				'UK' AS country,
				65999 AS price,
				'GBP' AS currency,
				'https://www.pricerunner.com/gotostore/v1/UK/2137_B084LFKLFJ?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'10436420-a75e-432e-bed5-0b5f4bfb3094' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_UK' AS offer_source,
				'Samsung G985 S20+ Galaxy 4G 8GB RAM 128GB DS cosmic black EU' AS retail_prod_name,
				'Amazon.co.uk' AS retailer_name,
				'UK' AS country,
				69900 AS price,
				'GBP' AS currency,
				'https://www.pricerunner.com/gotostore/v1/UK/2137_B084LFT861?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'84637311-5192-4674-ab5c-a73ed3f30909' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_UK' AS offer_source,
				'Samsung Galaxy S20+ 4G SIM Unlocked (Brand New), Cosmic Black' AS retail_prod_name,
				'Major Mobiles' AS retailer_name,
				'UK' AS country,
				69900 AS price,
				'GBP' AS currency,
				'https://www.pricerunner.com/gotostore/v1/UK/111447_32529415340113?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'037ed696-e08b-4533-b3da-7fd212765433' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_UK' AS offer_source,
				'Samsung G985 S20+ Galaxy 4G 8GB RAM 128GB DS cosmic grey EU' AS retail_prod_name,
				'Amazon.co.uk' AS retailer_name,
				'UK' AS country,
				71445 AS price,
				'GBP' AS currency,
				'https://www.pricerunner.com/gotostore/v1/UK/2137_B084LFG1DW?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'1708af1f-0103-4b8e-9138-b77adb7bcfa8' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_UK' AS offer_source,
				'Samsung GALAXY S20+ BLUE 6.7IN 4G 128GB 8 GB ANDROID 10' AS retail_prod_name,
				'Amazon.co.uk' AS retailer_name,
				'UK' AS country,
				76093 AS price,
				'GBP' AS currency,
				'https://www.pricerunner.com/gotostore/v1/UK/2137_B084J4Y4LJ?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'c96ecd28-9941-4f6c-b0fc-6ee122abc3a5' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_UK' AS offer_source,
				'Samsung Galaxy S20 Plus (4G) 128GB 8GB RAM Dual Sim Unlocked for All UK Network - Cosmic Black' AS retail_prod_name,
				'Electronics Frontier' AS retailer_name,
				'UK' AS country,
				79900 AS price,
				'GBP' AS currency,
				'https://www.pricerunner.com/gotostore/v1/UK/109750_Samsung%20S20%20Plus%208%20%2B128GB%204G%20Black?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'10cbcc60-fdd1-4f62-a2a8-3ea579f7fe6b' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_UK' AS offer_source,
				'Samsung Galaxy S20+ Plus (4G) Dual/Hybrid-SIM SM-G985F/DS 128GB [ Cosmic Grey | Cloud Blue | Cosmic Black ]' AS retail_prod_name,
				'Kick Mobiles' AS retailer_name,
				'UK' AS country,
				104900 AS price,
				'GBP' AS currency,
				'https://www.pricerunner.com/gotostore/v1/UK/60210_samsung-galaxy-s20-plus-4g?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'18ab813c-248f-4b7a-8fba-00de8dd69876' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_UK' AS offer_source,
				'Samsung GALAXY S20 ROSE 6.2IN 4G 128GB 8 GB ANDROID 10' AS retail_prod_name,
				'Amazon.co.uk' AS retailer_name,
				'UK' AS country,
				106764 AS price,
				'GBP' AS currency,
				'https://www.pricerunner.com/gotostore/v1/UK/2137_B084J4KB2B?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'6ff36400-1dfe-4d2e-86f6-672f200b5032' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_UK' AS offer_source,
				'Samsung GALAXY S20+ BLACK 6.7IN 4G 128GB 8 GB ANDROID 10' AS retail_prod_name,
				'Amazon.co.uk' AS retailer_name,
				'UK' AS country,
				110849 AS price,
				'GBP' AS currency,
				'https://www.pricerunner.com/gotostore/v1/UK/2137_B084J4GVHR?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'38ac4e8a-9c57-47a1-a986-d186ea2629d6' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20+ 4G 128GB Grå Dual-SIM' AS retail_prod_name,
				'NordicElectronics' AS retailer_name,
				'DK' AS country,
				546800 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/102752_SM-G985FZADEUB?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'7b5e707c-0073-416b-bb21-dec2bd31c17c' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20+ Grey' AS retail_prod_name,
				'Inphone.dk' AS retailer_name,
				'DK' AS country,
				547000 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/58986_8786757433434545?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'7e56bc9e-23c7-49e4-992e-cb2c679651c8' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20 6.7" 128GB Kosmisk grå --> På lager, levering hos dig 09-12-2020' AS retail_prod_name,
				'CompuMail' AS retailer_name,
				'DK' AS country,
				552300 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/1325_995776887?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'2fde7e41-a446-451b-88da-7005a9a40864' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20 6.7" 128GB Himmelblå --> På lager, levering hos dig 09-12-2020' AS retail_prod_name,
				'CompuMail' AS retailer_name,
				'DK' AS country,
				553000 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/1325_995776888?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'921253a1-7487-4558-a80f-b6e1d489ca37' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Galaxy S20+ 4G 128GB Sort' AS retail_prod_name,
				'Licotronic' AS retailer_name,
				'DK' AS country,
				563600 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/30852_1000689455?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'3d153180-a9f4-4298-bee8-8192d7762e14' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20+ - Smartphone - dual-SIM - 4G LTE - 128 GB - microSD slot - GSM - 6.7 - 3200 x 1440 pixels (525 ppi) - Infinity-O Dynamic AMOLED 2X - RAM 8 GB 10 Megapixel - 4x bagkameraer - Android - kosmisk sort' AS retail_prod_name,
				'ComputerSalg A/S' AS retailer_name,
				'DK' AS country,
				568600 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/589_6084279?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'2c794081-a16c-49ea-841e-e675871d58f5' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy SM-G985F/DS, 17 cm (6.7), 8 GB, 128 GB, 12 MP, Android 10.0, Sort' AS retail_prod_name,
				'ComputerSalg A/S' AS retailer_name,
				'DK' AS country,
				579500 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/589_6630507?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'845e61e9-59ab-413b-ae3e-064d9c838aeb' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20 Plus 128GB SM-G985F/DS Cosmic Gray' AS retail_prod_name,
				'Telegiganten' AS retailer_name,
				'DK' AS country,
				579900 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/50742_141717923365974?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'cce177e8-ad7b-44b4-8866-35d521c66303' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20 Plus 8GB 4G (128GB/Cosmic Grey)' AS retail_prod_name,
				'Salgsbutikken' AS retailer_name,
				'DK' AS country,
				580000 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/19678_Samsung%20Galaxy%20S20%20Plus%208GB%204G%20%28128GB%2FCosmic%20Grey%29?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'95a45910-582f-4493-824c-9105d6899828' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20 Plus 8GB 4G (128GB/Cosmic Black)' AS retail_prod_name,
				'Salgsbutikken' AS retailer_name,
				'DK' AS country,
				583000 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/19678_Samsung%20Galaxy%20S20%20Plus%208GB%204G%20%28128GB%2FCosmic%20Black%29?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'a43bed91-ebf7-437a-888d-77b4a94f1631' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20 Plus 128 GB --> På lager, levering hos dig 09-12-2020' AS retail_prod_name,
				'CompuMail' AS retailer_name,
				'DK' AS country,
				587000 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/1325_996072783?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'3ad09e85-54f5-4ae5-aa1d-c616e502d87b' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'SAMSUNG GALAXY S20+ cloud blue G985F Dual-SIM 128GB Android 10.0 Smartphone' AS retail_prod_name,
				'Jumbo Computer' AS retailer_name,
				'DK' AS country,
				588300 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/34682_1000689457?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'0dac633d-db1e-4e88-af44-662719013db3' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy SM-G985F 17 cm (6.7") 8 GB 128 GB 4G USB Type-C Grå Android 10.0 4500 mAh' AS retail_prod_name,
				'MediaSupply' AS retailer_name,
				'DK' AS country,
				596430 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/108211_45671?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'ac5bae79-793a-4780-9537-8d6a974cda03' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20 Plus 128GB SM-G985F/DS Cosmic Black' AS retail_prod_name,
				'Telegiganten' AS retailer_name,
				'DK' AS country,
				599500 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/50742_141717923365953?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'556a4857-8abc-468c-b0b0-2fe493bf659c' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy SM-G985F/DS, 17 cm (6.7), 8 GB, 128 GB, 12 MP, Android 10.0, Sort' AS retail_prod_name,
				'ComputerSalg A/S' AS retailer_name,
				'DK' AS country,
				601400 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/589_6139310?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'e14fb115-029e-4a87-9448-9e70dcc13e38' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'S20Plus ds Grey' AS retail_prod_name,
				'Stratek Data' AS retailer_name,
				'DK' AS country,
				613000 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/19687_1000689460?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'90f09764-daf4-40f7-a5bf-f876f736c272' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy SM-G985F 17 cm (6.7") 8 GB 128 GB 4G USB Type-C Sort Android 10.0 4500 mAh' AS retail_prod_name,
				'MediaSupply' AS retailer_name,
				'DK' AS country,
				620865 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/108211_45672?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'b6666fcf-5c57-43ba-a436-9cf957235ce8' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20 Plus 4G 128GB - Cosmic Black' AS retail_prod_name,
				'Proshop.dk' AS retailer_name,
				'DK' AS country,
				629500 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/2957_2832290?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'c2b08a95-fc59-4a8e-9f26-7fd01e223c2c' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20+ - kosmisk grå - 4G - 128 GB - GSM - smartphone' AS retail_prod_name,
				'Føniks Computer' AS retailer_name,
				'DK' AS country,
				630600 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/3092_F21086899?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'1b115168-278f-4fa4-95b8-a271b7e84ac5' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20+ - himmelblå - 4G - 128 GB - GSM - smartphone' AS retail_prod_name,
				'Føniks Computer' AS retailer_name,
				'DK' AS country,
				631400 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/3092_F21086891?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'8b6db665-68ee-434f-a973-aa08b6a04ada' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20+ - kosmisk sort - 4G - 128 GB - GSM - smartphone' AS retail_prod_name,
				'Føniks Computer' AS retailer_name,
				'DK' AS country,
				635500 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/3092_F21086896?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'e56c7fea-e8e4-4f39-8c82-e65e4bece9e0' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20+ SM-G985F 17 cm (6.7) 8 GB 128 GB 4G USB Type-C Black Android 10.0 4500 mAh' AS retail_prod_name,
				'ComputerSalg A/S' AS retailer_name,
				'DK' AS country,
				637800 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/589_6836096?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'c673b5ef-f8da-4b4e-a5de-45f369ee1299' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'GALAXY S20+ cloud blue G985F Dual-SIM 128GB Android 10.0 Smartphone' AS retail_prod_name,
				'MBit Solutions' AS retailer_name,
				'DK' AS country,
				641300 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/104555_1000689457?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'71370a41-ecbb-486e-b29c-025f5aaf5421' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung S20Plus ds Grå' AS retail_prod_name,
				'Wattoo.dk' AS retailer_name,
				'DK' AS country,
				645400 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/69119_DEL3008023?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				-- We need to create a random ID since the existing
				-- joins expects that
				'0073e78d-7ce7-4d6d-9b3c-11a9cfc14875' AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				'pricerunner_DK' AS offer_source,
				'Samsung Galaxy S20+ - Smartphone - dual-SIM - 4G LTE - 128 GB - microSD slot - GSM - 6.7 - 3200 x 1440 pixels (525 ppi) - Infinity-O Dynamic AMOLED 2X - RAM 8 GB 10 Megapixel - 4x bagkameraer - Android - himmelblå' AS retail_prod_name,
				'ComputerSalg A/S' AS retailer_name,
				'DK' AS country,
				679800 AS price,
				'DKK' AS currency,
				'https://www.pricerunner.dk/gotostore/v1/DK/589_6100697?productId=5158332' AS offer_url,
				'2020-12-08T14:50:14Z' AS requested_at,
				1::int AS match_score
			UNION ALL
		
			SELECT
				NULL AS offer_id,
				NULL AS updated_at,
				NULL AS product_id,
				NULL AS source,
				NULL AS retailer_product_name,
				NULL AS retailer_name,
				NULL AS country,
				NULL AS price,
				NULL AS currency,
				NULL AS offer_url,
				NULL AS requested_at,
				NULL AS match_score
		), offers_raw AS ( ---- take retailer data, calculate the price and filter out blacklisted retailer
			SELECT
				A.*,
				C.domain,
				C.id AS retailer_id,
				C.offer_source_id,
				((A.price::int * E.to_sek) / 100)::int AS adj_price -- the price adjusted for the currency
			FROM offers_data A
			INNER JOIN offer_sources B
			ON A.offer_source = B.name
			FULL OUTER JOIN retailers C
			ON A.retailer_name = C.name AND B.id = C.offer_source_id
			INNER JOIN currency E
			ON A.currency = E.name
			WHERE COALESCE(C.blacklisted, FALSE) IS FALSE -- Remove blacklisted retailers
		-- Add shipping data (where we have it) to the raw offers rows
		), offers_with_shipping AS (
			SELECT
				DISTINCT ON (A.offer_id)
				A.*,
				B.ship,
		--		((B.min_order_val * C.to_sek) / 100)::int AS min_order_val, -- adjusted for the currency
		--		((B.fee * C.to_sek) / 100)::int AS fee, -- adjusted for the currency
				CASE
					-- When we don't have shipping data => return estimation in some cases
					WHEN fee IS NULL THEN
						CASE
							WHEN A.country IN ('UK', 'IT', 'ES') THEN 406
							WHEN A.country IN ('FR', 'BE', 'LU', 'DE') THEN 203
							WHEN A.country = 'SE' THEN 0
							ELSE NULL
						END
					-- When we have shipping and item price is higher then min order value => return the fee
					WHEN (((B.min_order_val * C.to_sek) / 100) > A.adj_price) THEN ((B.fee * C.to_sek) / 100)::int
					-- When we have shipping and there is no min order value => return the fee
					WHEN (min_order_val IS NULL AND fee IS NOT NULL) THEN ((B.fee * C.to_sek) / 100)::int
					ELSE NULL
				END AS shipping_fee
			FROM offers_raw A
			FULL OUTER JOIN shipping B
			ON A.retailer_id = B.retailer_id
			FULL OUTER JOIN currency C
			ON B.currency = C.name
		-- Add retailer trust data and determine quality score
		), offers_with_shipping_and_trust AS (
			SELECT
				DISTINCT ON (A.offer_id)
				A.*,
				(adj_price + shipping_fee) * 0.03 AS exchange_rate_fee,
				(adj_price + shipping_fee) * 0.05 AS service_fee,
				((adj_price + shipping_fee) * 0.05) * 0.25 AS vat,
				(adj_price + shipping_fee + ((adj_price + shipping_fee) * 0.05) + (((adj_price + shipping_fee) * 0.05) * 0.25)) * 0.014 AS payment_fee_se,
				(adj_price + shipping_fee + ((adj_price + shipping_fee) * 0.03) + ((adj_price + shipping_fee) * 0.05) + (((adj_price + shipping_fee) * 0.05) * 0.25)) * 0.014 AS payment_fee_int,
				CASE
					-- If no Trustpilot rating
					WHEN avg_rating = 0 THEN
						CASE
							WHEN site_rank < 15000 	THEN 5
							WHEN site_rank < 25000 	THEN 4.5
							WHEN site_rank < 50000 	THEN 4
							WHEN site_rank < 75000 	THEN 3
							WHEN site_rank < 100000 THEN 2
							WHEN site_rank < 300000 THEN 1.5
							WHEN site_rank < 500000 THEN 1
						END
					-- If we have Truspilot rating, start with that rating and then credit or discredit it
					WHEN avg_rating != 0 THEN (
						SELECT (
							avg_rating +
							CASE
								WHEN num_ratings < 50 THEN -1
								WHEN num_ratings < 100 THEN -0.5
								WHEN num_ratings > 1000 THEN 0.5
								WHEN num_ratings > 5000 THEN 1
								ELSE 0
							END +
							CASE WHEN num_ratings < 100 THEN -0.5 ELSE 0 END +
							CASE
								WHEN site_rank < 15000 THEN 1
								WHEN site_rank < 25000 THEN 0.5
								WHEN site_rank > 100000 THEN -0.5
								WHEN (site_rank > 300000) OR (site_rank IS NULL) THEN -1
								ELSE 0
							END
						)
					)
				END AS quality_score
			FROM offers_with_shipping A
			FULL OUTER JOIN alexa B
			ON A.domain = B.retailer_domain
			FULL OUTER JOIN trustpilot C
			ON A.domain = C.retailer_domain
		), lowest_local_price AS ( ---- get the lowest price among offers, this step touch all the offers including old and new
			SELECT
				MIN(adj_price)
			FROM offers_with_shipping_and_trust
			WHERE country = 'SE' -- Change this when we launch another country
		/*
			Filter out offers:
				1. That do not pass the string matching test.
				2. Which are from black listed retailers (second hand for example)
				3. Which we have duplicates on, for example the same from prisjakt as pricerunner
		*/
		), offers_filtered AS (
			SELECT
				-- Filter out when we from different sources have gotten the same offer
				DISTINCT ON (A.retail_prod_name, A.domain, A.adj_price)
				A.*
			FROM offers_with_shipping_and_trust A
			LEFT JOIN (
				SELECT
					A.*
				FROM offers_with_shipping_and_trust A
				-- Grab the offer sources to filter dynamically to be able to configure
				-- this on the fly without having to re-deploy stuff
				WHERE A.offer_source SIMILAR TO (
					SELECT
						array_to_string(
								array(
										SELECT
											name
										FROM offer_sources
										WHERE filter IS TRUE
								), '|'
						)
				)
				AND (
								(A.adj_price < (SELECT * FROM lowest_local_price) *  (SELECT value FROM offer_filters WHERE name = 'min_price')) OR
								(A.adj_price > (SELECT * FROM lowest_local_price) *  (SELECT value FROM offer_filters WHERE name = 'max_price'))
						)
			) C
			ON A.offer_id = C.offer_id
			WHERE C.offer_id IS NULL
			-- Blacklisted retailers
			AND lower(A.retailer_name) NOT SIMILAR TO 'bluecity%|datapryl%'
		), offers_complete AS (
			SELECT
				*,
				--((SELECT * FROM lowest_local_price) - B.adj_price) AS saving,
				CASE
					WHEN shipping_fee IS NOT NULL AND offer_source != 'google_shopping_SE' AND country != 'SE' THEN true
					ELSE false
				END AS direct_checkout,
				CASE
					WHEN shipping_fee IS NOT NULL AND offer_source != 'google_shopping_SE' AND country != 'SE' THEN
						CASE
							WHEN country != 'SE' THEN ((adj_price + shipping_fee + service_fee + vat + payment_fee_int + exchange_rate_fee) )
							ELSE NULL
						END
					ELSE NULL
				END AS direct_checkout_price,
				CASE
					WHEN quality_score > 5 THEN 5
					WHEN quality_score < 1 THEN 1
					ELSE quality_score::float
				END AS quality_score_adjusted
			FROM (
				SELECT
					*
				FROM offers_filtered
			) B
		)
		SELECT
			updated_at,
			product_id,
			offer_source,
			retail_prod_name,
			retailer_name,
			country,
			(adj_price * 100)::int AS price,
			'SEK' AS currency,
			offer_url,
			quality_score_adjusted AS quality_score,
			domain,
			CASE -- Ship should be true when direct_checkout is enabled
				WHEN direct_checkout IS TRUE THEN TRUE
				ELSE ship
			END AS ship,
			(shipping_fee * 100)::int AS shipping_fee,
			(((SELECT * FROM lowest_local_price) - adj_price) * 100)::int AS saving,
			CASE -- Only show saving when direct_checkout is enabled
				WHEN direct_checkout IS TRUE THEN
					CASE -- Only show saving when the offer is less expensive then the Swedish one
				 		WHEN ((SELECT * FROM lowest_local_price) > direct_checkout_price) THEN (((SELECT * FROM lowest_local_price) - direct_checkout_price) * 100)::int
						ELSE NULL
					END
				ELSE NULL
			END AS direct_checkout_saving,
			offer_id,
			direct_checkout,
			(direct_checkout_price * 100)::int AS direct_checkout_price,
			CASE -- Don't enable concierge on Swedish offers or when direct_checkout is enabled
				WHEN direct_checkout IS FALSE AND country != 'SE' THEN TRUE
				ELSE FALSE
			END AS concierge
		FROM offers_complete
		WHERE offer_source IS NOT NULL-- Remove the row needed for the union
		AND offer_source NOT LIKE 'google_shopping%'-- TEMPORARY REMOVE GOOGLE SHOPPING
		ORDER BY direct_checkout_price ASC;
	